# ğŸ“‹ åŠŸèƒ½å®ç°æ€»ç»“

## å·²å®Œæˆçš„ä»»åŠ¡ âœ…

### 1. å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ

**å®ç°æ–‡ä»¶ï¼š**
- `app/logger.py` - æ—¥å¿—ç®¡ç†å™¨å’Œæ—¥å¿—è®°å½•å™¨
- `app/middleware.py` - è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
- `clean_logs.py` - ç‹¬ç«‹çš„æ—¥å¿—æ¸…ç†å·¥å…·

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… å•ç‹¬çš„ `logs/` æ–‡ä»¶å¤¹å­˜å‚¨æ‰€æœ‰æ—¥å¿—
- âœ… æŒ‰å¤©åˆ†å‰²æ—¥å¿—æ–‡ä»¶ï¼ˆæ¯å¤©åˆå¤œè‡ªåŠ¨åˆ†å‰²ï¼‰
- âœ… è‡ªåŠ¨ä¿ç•™æœ€è¿‘ 7 å¤©çš„æ—¥å¿—
- âœ… æ—¥å¿—æ€»å¤§å°è¶…è¿‡ 2GB æ—¶è‡ªåŠ¨æ¸…ç†æœ€æ—§çš„æ—¥å¿—
- âœ… è®°å½•æ‰€æœ‰ API è¯·æ±‚ã€å“åº”çŠ¶æ€ç å’Œè€—æ—¶
- âœ… è®°å½•æ‰€æœ‰é”™è¯¯å’Œå¼‚å¸¸ï¼ˆåŒ…å«å †æ ˆè·Ÿè¸ªï¼‰
- âœ… åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œæ—¥å¿—æ¸…ç†

**æ—¥å¿—å†…å®¹åŒ…æ‹¬ï¼š**
- åº”ç”¨å¯åŠ¨/åœæ­¢äº‹ä»¶
- æ‰€æœ‰ HTTP è¯·æ±‚å’Œå“åº”
- è¯·æ±‚è€—æ—¶ç»Ÿè®¡
- é”™è¯¯å’Œå¼‚å¸¸ï¼ˆå¸¦å®Œæ•´å †æ ˆè·Ÿè¸ªï¼‰
- Webhook æ¥æ”¶å’Œéƒ¨ç½²äº‹ä»¶

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/display_date.log

# æ‰‹åŠ¨æ¸…ç†æ—¥å¿—
python3 clean_logs.py

# æµ‹è¯•æ—¥å¿—ç³»ç»Ÿ
python3 test_features.py
```

---

### 2. GitHub Webhook è‡ªåŠ¨éƒ¨ç½²

**å®ç°æ–‡ä»¶ï¼š**
- `app/routers/webhook.py` - Webhook è·¯ç”±å¤„ç†
- `auto_deploy.sh` - è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
- `app/config.py` - æ·»åŠ äº† webhook å¯†é’¥é…ç½®

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… æ¥æ”¶ GitHub æ¨é€é€šçŸ¥
- âœ… HMAC-SHA256 ç­¾åéªŒè¯ï¼ˆå®‰å…¨ï¼‰
- âœ… åå°æ‰§è¡Œéƒ¨ç½²ä»»åŠ¡ï¼ˆä¸é˜»å¡ APIï¼‰
- âœ… è‡ªåŠ¨æ‹‰å–æœ€æ–°ä»£ç 
- âœ… è‡ªåŠ¨å®‰è£…/æ›´æ–°ä¾èµ–
- âœ… è‡ªåŠ¨æ¸…ç†æ—¥å¿—
- âœ… è‡ªåŠ¨é‡å¯æœåŠ¡ï¼ˆæ”¯æŒ systemd/Docker/æ‰‹åŠ¨è¿›ç¨‹ï¼‰
- âœ… è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—è®°å½•

**æ–°å¢ API ç«¯ç‚¹ï¼š**
- `POST /webhook/github` - æ¥æ”¶ GitHub webhook
- `GET /webhook/test` - æµ‹è¯• webhook ç«¯ç‚¹

**éƒ¨ç½²æµç¨‹ï¼š**
```
æ¨é€ä»£ç  â†’ GitHub å‘é€ Webhook â†’ éªŒè¯ç­¾å â†’ åå°æ‰§è¡Œéƒ¨ç½²è„šæœ¬
â†’ æ‹‰å–ä»£ç  â†’ æ›´æ–°ä¾èµ– â†’ æ¸…ç†æ—¥å¿— â†’ é‡å¯æœåŠ¡ â†’ å¥åº·æ£€æŸ¥
```

**å®‰å…¨ç‰¹æ€§ï¼š**
- HMAC-SHA256 ç­¾åéªŒè¯
- åªå¤„ç† push äº‹ä»¶
- åªå¤„ç† master/main åˆ†æ”¯
- åå°å¼‚æ­¥æ‰§è¡Œï¼ˆ5åˆ†é’Ÿè¶…æ—¶ï¼‰

---

## æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶
```
app/
â”œâ”€â”€ logger.py              # æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ middleware.py          # æ—¥å¿—è®°å½•ä¸­é—´ä»¶ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ routers/
    â””â”€â”€ webhook.py         # Webhook è·¯ç”±ï¼ˆæ–°å¢ï¼‰

logs/                      # æ—¥å¿—æ–‡ä»¶å¤¹ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ display_date.log       # å½“å‰æ—¥å¿—
â””â”€â”€ display_date.log.YYYY-MM-DD  # å†å²æ—¥å¿—

auto_deploy.sh             # è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼ˆæ–°å¢ï¼‰
clean_logs.py              # æ—¥å¿—æ¸…ç†å·¥å…·ï¼ˆæ–°å¢ï¼‰
test_features.py           # åŠŸèƒ½æµ‹è¯•è„šæœ¬ï¼ˆæ–°å¢ï¼‰
WEBHOOK_SETUP.md           # Webhook é…ç½®æŒ‡å—ï¼ˆæ–°å¢ï¼‰
QUICK_START.md             # å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆæ–°å¢ï¼‰
SUMMARY.md                 # æœ¬æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰
```

### ä¿®æ”¹çš„æ–‡ä»¶
```
app/
â”œâ”€â”€ main.py                # æ·»åŠ æ—¥å¿—ä¸­é—´ä»¶å’Œ webhook è·¯ç”±
â”œâ”€â”€ config.py              # æ·»åŠ  github_webhook_secret é…ç½®
â””â”€â”€ routers/
    â””â”€â”€ __init__.py        # å¯¼å‡º webhook è·¯ç”±ï¼ˆå¦‚æœéœ€è¦ï¼‰

env.example                # æ·»åŠ  GITHUB_WEBHOOK_SECRET é…ç½®é¡¹
.gitignore                 # æ·»åŠ  logs/ å¿½ç•¥è§„åˆ™
README.md                  # æ›´æ–°åŠŸèƒ½åˆ—è¡¨å’Œæ–‡æ¡£
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

éœ€è¦æ·»åŠ ä»¥ä¸‹æ–°é…ç½®ï¼š

```env
# GitHub Webhook å¯†é’¥ï¼ˆç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼‰
GITHUB_WEBHOOK_SECRET=your-webhook-secret-here
```

ç”Ÿæˆå¯†é’¥ï¼š
```bash
openssl rand -hex 32
```

### æ—¥å¿—é…ç½®

æ—¥å¿—ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹é»˜è®¤é…ç½®ï¼ˆåœ¨ `app/logger.py` ä¸­ï¼‰ï¼š

```python
log_dir = "logs"              # æ—¥å¿—æ–‡ä»¶å¤¹
keep_days = 7                 # ä¿ç•™å¤©æ•°
max_total_size_gb = 2.0       # æœ€å¤§æ€»å¤§å°ï¼ˆGBï¼‰
```

å¦‚éœ€ä¿®æ”¹ï¼Œç¼–è¾‘ `app/logger.py` ä¸­çš„ `LogManager` åˆå§‹åŒ–å‚æ•°ã€‚

---

## æµ‹è¯•æ–¹æ³•

### 1. æµ‹è¯•æ—¥å¿—ç³»ç»Ÿ

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 test_features.py

# å¯åŠ¨åº”ç”¨
python3 run.py

# å‘é€æµ‹è¯•è¯·æ±‚
curl http://localhost:8000/

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/display_date.log
```

### 2. æµ‹è¯• Webhook

```bash
# æµ‹è¯•ç«¯ç‚¹å¯è®¿é—®æ€§
curl http://localhost:8000/webhook/test

# åº”è¯¥è¿”å›ï¼š
# {"message":"Webhook endpoint is working"}

# æµ‹è¯•å®Œæ•´çš„è‡ªåŠ¨éƒ¨ç½²æµç¨‹ï¼š
# 1. é…ç½® GitHub webhook
# 2. æ¨é€ä»£ç 
# 3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤éƒ¨ç½²æˆåŠŸ
tail -f logs/display_date.log | grep webhook
```

### 3. æµ‹è¯•æ—¥å¿—æ¸…ç†

```bash
# è¿è¡Œæ¸…ç†å·¥å…·
python3 clean_logs.py

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤¹
ls -lh logs/

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤¹å¤§å°
du -sh logs/
```

---

## éƒ¨ç½²æ­¥éª¤

### å¼€å‘ç¯å¢ƒæµ‹è¯•

1. **å®‰è£…ä¾èµ–**ï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
   ```bash
   pip install -r requirements.txt
   ```

2. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   # ç”Ÿæˆ webhook å¯†é’¥
   openssl rand -hex 32
   
   # æ·»åŠ åˆ° .env
   echo "GITHUB_WEBHOOK_SECRET=ç”Ÿæˆçš„å¯†é’¥" >> .env
   ```

3. **æµ‹è¯•åŠŸèƒ½**
   ```bash
   python3 test_features.py
   ```

4. **å¯åŠ¨åº”ç”¨**
   ```bash
   python3 run.py
   ```

5. **éªŒè¯æ—¥å¿—**
   ```bash
   tail -f logs/display_date.log
   ```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **æ‹‰å–ä»£ç **
   ```bash
   cd /path/to/display_date_python
   git pull
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   source venv/bin/activate
   pip install -r requirements.txt
   ```

3. **é…ç½® Webhook å¯†é’¥**
   ```bash
   # ç”Ÿæˆå¯†é’¥å¹¶æ·»åŠ åˆ° .env
   openssl rand -hex 32 | xargs -I {} echo "GITHUB_WEBHOOK_SECRET={}" >> .env
   ```

4. **è®¾ç½®è„šæœ¬æƒé™**
   ```bash
   chmod +x auto_deploy.sh clean_logs.py
   ```

5. **é‡å¯æœåŠ¡**
   ```bash
   sudo systemctl restart display-date
   # æˆ–
   docker-compose restart
   ```

6. **é…ç½® GitHub Webhook**
   - æŒ‰ç…§ `WEBHOOK_SETUP.md` ä¸­çš„æ­¥éª¤é…ç½®

7. **æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²**
   ```bash
   # æ¨é€æµ‹è¯•ä»£ç 
   git add .
   git commit -m "Test auto deploy"
   git push
   
   # æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
   tail -f logs/display_date.log
   ```

---

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/display_date.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/display_date.log

# æŸ¥çœ‹ webhook äº‹ä»¶
grep webhook logs/display_date.log

# æŸ¥çœ‹è¯·æ±‚ç»Ÿè®¡
grep "è¯·æ±‚å®Œæˆ" logs/display_date.log | tail -20
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ—¥å¿—å¤§å°
du -sh logs/

# æ‰‹åŠ¨æ¸…ç†æ—¥å¿—
python3 clean_logs.py

# è®¾ç½®å®šæ—¶æ¸…ç†ï¼ˆå¯é€‰ï¼‰
crontab -e
# æ·»åŠ ï¼š0 2 * * * cd /path/to/project && python3 clean_logs.py
```

### éƒ¨ç½²ç›‘æ§

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status display-date

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
grep "è‡ªåŠ¨éƒ¨ç½²" logs/display_date.log

# æŸ¥çœ‹ GitHub webhook æ¨é€å†å²
# è®¿é—®ï¼šGitHub ä»“åº“ â†’ Settings â†’ Webhooks â†’ ç‚¹å‡»ä½ çš„ webhook â†’ Recent Deliveries
```

---

## å¸¸è§é—®é¢˜

### Q1: æ—¥å¿—æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Ÿ
A: åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºã€‚å¦‚éœ€æ‰‹åŠ¨åˆ›å»ºï¼š`mkdir logs`

### Q2: Webhook æœªè§¦å‘ï¼Ÿ
A: æ£€æŸ¥ï¼š
- GitHub webhook é…ç½®æ˜¯å¦æ­£ç¡®
- æœåŠ¡å™¨æ˜¯å¦å¯ä»å¤–ç½‘è®¿é—®
- æŸ¥çœ‹ GitHub webhook æ¨é€å†å²ä¸­çš„é”™è¯¯
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š`tail -f logs/display_date.log`

### Q3: ç­¾åéªŒè¯å¤±è´¥ï¼Ÿ
A: ç¡®ä¿ `.env` ä¸­çš„å¯†é’¥ä¸ GitHub é…ç½®ä¸€è‡´ï¼Œé‡å¯æœåŠ¡

### Q4: éƒ¨ç½²å¤±è´¥ï¼Ÿ
A: 
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š`tail -f logs/display_date.log`
- æ‰‹åŠ¨æ‰§è¡Œæµ‹è¯•ï¼š`bash auto_deploy.sh`
- æ£€æŸ¥è„šæœ¬æƒé™ï¼š`chmod +x auto_deploy.sh`

### Q5: æ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Ÿ
A: è¿è¡Œæ¸…ç†å·¥å…·ï¼š`python3 clean_logs.py`

---

## æ€§èƒ½å½±å“

### æ—¥å¿—ç³»ç»Ÿ
- **CPU**: æä½ï¼ˆå¼‚æ­¥å†™å…¥ï¼‰
- **å†…å­˜**: < 10MB
- **ç£ç›˜**: å—æ§åˆ¶ï¼ˆæœ€å¤§ 2GBï¼‰
- **å»¶è¿Ÿ**: < 1msï¼ˆè¯·æ±‚æ—¥å¿—è®°å½•ï¼‰

### Webhook è‡ªåŠ¨éƒ¨ç½²
- **è§¦å‘å»¶è¿Ÿ**: < 2ç§’ï¼ˆGitHub â†’ æœåŠ¡å™¨ï¼‰
- **éƒ¨ç½²æ—¶é—´**: 30-60ç§’ï¼ˆå–å†³äºä»£ç å¤§å°ï¼‰
- **æœåŠ¡ä¸­æ–­**: 2-5ç§’ï¼ˆé‡å¯æœåŠ¡æœŸé—´ï¼‰
- **å¹¶å‘å½±å“**: æ— ï¼ˆåå°å¼‚æ­¥æ‰§è¡Œï¼‰

---

## å®‰å…¨è€ƒè™‘

### æ—¥å¿—å®‰å…¨
- âœ… ä¸è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€tokenç­‰ï¼‰
- âœ… æ—¥å¿—æ–‡ä»¶æƒé™ï¼š644ï¼ˆä»…æ‰€æœ‰è€…å¯å†™ï¼‰
- âœ… è‡ªåŠ¨æ¸…ç†ï¼Œé¿å…æ—¥å¿—æ³„éœ²å†å²ä¿¡æ¯

### Webhook å®‰å…¨
- âœ… HMAC-SHA256 ç­¾åéªŒè¯
- âœ… åªå¤„ç†æŒ‡å®šäº‹ä»¶å’Œåˆ†æ”¯
- âœ… åå°æ‰§è¡Œï¼Œè¶…æ—¶ä¿æŠ¤ï¼ˆ5åˆ†é’Ÿï¼‰
- âš ï¸  å»ºè®®ä½¿ç”¨ HTTPS
- âš ï¸  å»ºè®®é™åˆ¶è®¿é—® IPï¼ˆä»… GitHubï¼‰

---

## åç»­æ”¹è¿›å»ºè®®

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ æ—¥å¿—çº§åˆ«é…ç½®ï¼ˆDEBUG/INFO/WARNING/ERRORï¼‰
- [ ] æ·»åŠ æ—¥å¿—å‹ç¼©åŠŸèƒ½ï¼ˆgzipï¼‰
- [ ] æ·»åŠ éƒ¨ç½²å‰çš„æµ‹è¯•æ­¥éª¤
- [ ] æ·»åŠ éƒ¨ç½²å¤±è´¥æ—¶çš„å›æ»šæœºåˆ¶

### ä¸­æœŸï¼ˆå¯é€‰ï¼‰
- [ ] é›†æˆæ—¥å¿—åˆ†æå·¥å…·ï¼ˆELK/Grafanaï¼‰
- [ ] æ·»åŠ ç›‘æ§å’Œå‘Šè­¦ï¼ˆPrometheusï¼‰
- [ ] æ”¯æŒå¤šåˆ†æ”¯éƒ¨ç½²
- [ ] æ·»åŠ éƒ¨ç½²å®¡æ‰¹æµç¨‹

### é•¿æœŸï¼ˆå¯é€‰ï¼‰
- [ ] ä½¿ç”¨ä¸“ä¸šæ—¥å¿—æœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
- [ ] å®ç°è“ç»¿éƒ¨ç½²
- [ ] æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
- [ ] å®ç°é›¶åœæœºéƒ¨ç½²

---

## ç›¸å…³æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**: [QUICK_START.md](QUICK_START.md)
- **Webhook é…ç½®**: [WEBHOOK_SETUP.md](WEBHOOK_SETUP.md)
- **é¡¹ç›®æ–‡æ¡£**: [README.md](README.md)
- **API æ–‡æ¡£**: http://your-server:8000/docs

---

## å®Œæˆæ—¶é—´

- å¼€å§‹æ—¶é—´ï¼š2025-12-19 11:00
- å®Œæˆæ—¶é—´ï¼š2025-12-19 12:00
- æ€»è€—æ—¶ï¼šçº¦ 1 å°æ—¶

---

## æµ‹è¯•ç»“æœ

âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

```
æµ‹è¯• 1: æ—¥å¿—ç³»ç»Ÿ            âœ…
æµ‹è¯• 2: ä¸­é—´ä»¶              âœ…
æµ‹è¯• 3: Webhook è·¯ç”±        âœ…
æµ‹è¯• 4: ä¸»åº”ç”¨é›†æˆ          âœ…
æµ‹è¯• 5: é…ç½®                âœ…
æµ‹è¯• 6: éƒ¨ç½²è„šæœ¬            âœ…
```

---

**ç°åœ¨ä½ å¯ä»¥äº«å—è‡ªåŠ¨åŒ–éƒ¨ç½²äº†ï¼åªéœ€æ¨é€ä»£ç ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨æ›´æ–°ã€‚** ğŸš€
